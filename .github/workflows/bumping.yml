name: Bump version on PR

on:
  pull_request:
    types: [closed]
    branches:
      - "main"

  workflow_dispatch:
    inputs:
      enviroment:
        type: environment
        default: DEV
        required: true
      min_version:
        type: number
        default: "-"
        required: false
      major_version:
        default: "-"
        type: number
        required: false

jobs:
  envionment-check:
    runs-on: ubuntu-latest
    steps:
      - name: Check if version is required based on environment value
        run: |
          if [ "${{ github.event_name }}" == "workflow_dispatch" ]; then
            # if version is empty or dash AND envrionement is QA
            if [ "${{ github.event.inputs.enviroment }}" == "QA" ] && [ "${{ github.event.inputs.min_version }}" == "-" ]; then
              echo "Version is required for QA environment"
              exit 1
            fi
          fi
        shell: bash
  update-version:
    needs: envionment-check
    runs-on: ubuntu-latest
    steps:
      - name: Print actor of the event and of cloned pull request
        run: |
          echo ${{ github.actor }}
          echo "PR by ${{ github.actor }} from ${{ github.event.pull_request.head.ref }} to ${{ github.event.pull_request.base.ref }}"
        shell: bash

      - name: print hello if actor is not jarvis
        run: echo "Hello"
        shell: bash

  tag-to-deploy:
    needs: update-version
    uses: ./.github/workflows/tag_to_deploy.yml
    with:
      environment: ${{ github.event.inputs.enviroment }}
    permissions: write-all
    secrets: inherit
